#! /usr/bin/env ruby

require 'autoproj'
require 'autoproj/cmdline'
require 'pp'

Autoproj.silent = true
root_dir  = Autoproj::CmdLine.initialize_root_directory
selection = Autoproj::CmdLine.initialize_and_load(ARGV)

selection.each do |name|
    puts "resolved '#{name}' with"
    resolved = Autoproj.manifest.resolve_package_name(name)

    packages, osdeps = resolved.partition { |type, name| type == :package }
    packages = packages.map(&:last)
    osdeps   = osdeps.map(&:last)

    puts "#{packages.size} source packages"
    puts "  " + packages.sort.join("\n  ")
    puts "#{osdeps.size} OS dependencies"
    osdeps.each do |pkg_name|
        puts "  the osdep '#{pkg_name}'"
        Autoproj.osdeps.resolve_os_dependencies(pkg_name).each do |manager, packages|
            puts "    #{manager.names.first}: #{packages.map { |*subnames| subnames.join(" ") }.join(", ")}"
        end
    end
end

