#! /bin/sh

PAGES_BRANCH=gh-pages
DOC_DIR=doc/html

set -e

git reset -q HEAD

# Create the tree object
git add -f $DOC_DIR
tree=$(git write-tree --prefix=$DOC_DIR)

# Get the parent commit for the tree. If the branch does not yet exist, create
# it
msg="generated from $head_sha"
head_sha=$(git show-ref -s -h HEAD)
echo "resetting the $PAGES_BRANCH branch"
commit=$(echo $msg | git commit-tree $tree)

if test -n "$commit"; then
    # And finally update the tip of the branch
    git update-ref -m "updated documentation" refs/heads/$PAGES_BRANCH $commit
fi

git reset -q HEAD

